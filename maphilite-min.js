(function(b){var v,k,m,l,n,p,q,r,s,w,t;v=document.namespaces;k=!!document.createElement("canvas").getContext;b.mynamespace={inFocus:null,mouseEnter:null,mouseLeave:null};if(!k&&!v)b.fn.maphilite=function(){return this};else{if(k){r=function(c){return Math.max(0,Math.min(parseInt(c,16),255))};s=function(c,b){return"rgba("+r(c.substr(0,2))+","+r(c.substr(2,2))+","+r(c.substr(4,2))+","+b+")"};m=function(c){c=b('<canvas style="width:'+c.width+"px;height:"+c.height+'px;"></canvas>').get(0);c.getContext("2d").clearRect(0,
0,c.width,c.height);return c};var u=function(c,b,a,d,e){d=d||0;e=e||0;c.beginPath();if("rect"==b)c.rect(a[0]+d,a[1]+e,a[2]-a[0],a[3]-a[1]);else if("poly"==b){c.moveTo(a[0]+d,a[1]+e);for(i=2;i<a.length;i+=2)c.lineTo(a[i]+d,a[i+1]+e)}else"circ"==b&&c.arc(a[0]+d,a[1]+e,a[2],0,2*Math.PI,!1);c.closePath()};l=function(c,j,a,d){var e=c.getContext("2d");if(d.shadow){e.save();"inside"==d.shadowPosition&&(u(e,j,a),e.clip());var g=100*c.width,f=100*c.height;u(e,j,a,g,f);e.shadowOffsetX=d.shadowX-g;e.shadowOffsetY=
d.shadowY-f;e.shadowBlur=d.shadowRadius;e.shadowColor=s(d.shadowColor,d.shadowOpacity);(g=d.shadowFrom)||(g="outside"==d.shadowPosition?"fill":"stroke");"stroke"==g?(e.strokeStyle="rgba(0,0,0,1)",e.stroke()):"fill"==g&&(e.fillStyle="rgba(0,0,0,1)",e.fill());e.restore();"outside"==d.shadowPosition&&(e.save(),u(e,j,a),e.globalCompositeOperation="destination-out",e.fillStyle="rgba(0,0,0,1);",e.fill(),e.restore())}e.save();u(e,j,a);d.fill&&(e.fillStyle=s(d.fillColor,d.fillOpacity),e.fill());d.stroke&&
(e.strokeStyle=s(d.strokeColor,d.strokeOpacity),e.lineWidth=d.strokeWidth,e.stroke());e.restore();d.fade&&b(c).css("opacity",0).animate({opacity:1},100)};n=function(c){c.getContext("2d").clearRect(0,0,c.width,c.height);b.mynamespace.inFocus&&b.mynamespace.mouseLeave&&(b.mynamespace.mouseLeave(b.mynamespace.inFocus),b.mynamespace.inFocus=null)}}else m=function(c){return b('<var style="zoom:1;overflow:hidden;display:block;width:'+c.width+"px;height:"+c.height+'px;"></var>').get(0)},l=function(c,j,a,
d,e){var g,f,h;g='<v:fill color="#'+d.fillColor+'" opacity="'+(d.fill?d.fillOpacity:0)+'" />';f=d.stroke?'strokeweight="'+d.strokeWidth+'" stroked="t" strokecolor="#'+d.strokeColor+'"':'stroked="f"';d='<v:stroke opacity="'+d.strokeOpacity+'"/>';"rect"==j?h=b('<v:rect name="'+e+'" filled="t" '+f+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+a[0]+"px;top:"+a[1]+"px;width:"+(a[2]-a[0])+"px;height:"+(a[3]-a[1])+'px;"></v:rect>'):"poly"==j?h=b('<v:shape name="'+e+'" filled="t" '+
f+' coordorigin="0,0" coordsize="'+c.width+","+c.height+'" path="m '+a[0]+","+a[1]+" l "+a.join(",")+' x e" style="zoom:1;margin:0;padding:0;display:block;position:absolute;top:0px;left:0px;width:'+c.width+"px;height:"+c.height+'px;"></v:shape>'):"circ"==j&&(h=b('<v:oval name="'+e+'" filled="t" '+f+' style="zoom:1;margin:0;padding:0;display:block;position:absolute;left:'+(a[0]-a[2])+"px;top:"+(a[1]-a[2])+"px;width:"+2*a[2]+"px;height:"+2*a[2]+'px;"></v:oval>'));h.get(0).innerHTML=g+d;b(c).append(h)},
n=function(c){b(c).find("[name=highlighted]").remove();b.mynamespace.inFocus&&b.mynamespace.mouseLeave&&(b.mynamespace.mouseLeave(b.mynamespace.inFocus),b.mynamespace.inFocus=null)};p=function(c){var b,a=c.getAttribute("coords").split(",");for(b=0;b<a.length;b++)a[b]=parseFloat(a[b]);return[c.getAttribute("shape").toLowerCase().substr(0,4),a]};t=function(c,j){var a=b(c);return b.extend({},j,b.metadata?a.metadata():!1,a.data("maphilite"))};w=function(b){return!b.complete||"undefined"!=typeof b.naturalWidth&&
0===b.naturalWidth?!1:!0};q={position:"absolute",left:0,top:0,padding:0,border:0};var x=!1;b.fn.maphilite=function(c){c=b.extend({},b.fn.maphilite.defaults,c);c.mouseEnter&&(b.mynamespace.mouseEnter=c.mouseEnter);c.mouseLeave&&(b.mynamespace.mouseLeave=c.mouseLeave);if(!k&&b.browser.msie&&!x){document.namespaces.add("v","urn:schemas-microsoft-com:vml");var j=document.createStyleSheet();b.each("shape rect oval circ fill stroke imagedata group textbox".split(" "),function(){j.addRule("v\\:"+this,"behavior: url(#default#VML); antialias:true")});
x=!0}return this.each(function(){var a,d,e,g,f,h;a=b(this);if(!w(this))return window.setTimeout(function(){a.maphilite(c)},200);e=b.extend({},c,b.metadata?a.metadata():!1,a.data("maphilite"));d=a.get(0).getAttribute("usemap");g=b('map[name="'+d.substr(1)+'"]');a.is('img,input[type="image"]')&&(d&&0<g.size())&&(a.hasClass("maphiliteed")&&(d=a.parent(),a.insertBefore(d),d.remove(),b(g).unbind(".maphilite").find("area[coords]").unbind(".maphilite")),d=b("<div></div>").css({display:"block",background:'url("'+
this.src+'")',"background-size":this.width,"background-repeat":"no-repeat",position:"relative",padding:0,width:this.width,height:this.height}),e.wrapClass&&(!0===e.wrapClass?d.addClass(b(this).attr("class")):d.addClass(e.wrapClass)),a.before(d).css("opacity",0).css(q).remove(),b.browser.msie&&a.css("filter","Alpha(opacity=0)"),d.append(a),f=m(this),b(f).css(q),f.height=this.height,f.width=this.width,d=function(){var a,c;c=t(this,e);if(!c.neverOn&&!c.alwaysOn){a=p(this);l(f,a[0],a[1],c,"highlighted");
if(a=b(this).attr("href"))b.mynamespace.mouseEnter&&(a=a.substr(1),b.mynamespace.mouseEnter(a)),b.mynamespace.inFocus=a;if(c.groupBy){var d=this;(/^[a-zA-Z][\-a-zA-Z]+$/.test(c.groupBy)?g.find("area["+c.groupBy+'="'+b(this).attr(c.groupBy)+'"]'):g.find(c.groupBy)).each(function(){if(this!=d){var a=t(this,e);if(!a.neverOn&&!a.alwaysOn){var b=p(this);l(f,b[0],b[1],a,"highlighted")}}})}k||b(f).append("<v:rect></v:rect>")}},b(g).bind("alwaysOn.maphilite",function(){h&&n(h);k||b(f).empty();b(g).find("area[coords]").each(function(){var c,
d;d=t(this,e);d.alwaysOn&&(!h&&k&&(h=m(a[0]),b(h).css(q),h.width=a[0].width,h.height=a[0].height,a.before(h)),d.fade=d.alwaysOnFade,c=p(this),k?l(h,c[0],c[1],d,""):l(f,c[0],c[1],d,""))})}),b(g).trigger("alwaysOn.maphilite").find("area[coords]").bind("mouseover.maphilite",d).bind("mouseout.maphilite",function(){n(f)}),a.before(f),a.addClass("maphiliteed"))})};b.fn.maphilite.defaults={fill:!0,fillColor:"000000",fillOpacity:0.2,stroke:!0,strokeColor:"ff0000",strokeOpacity:1,strokeWidth:1,fade:!0,alwaysOn:!1,
neverOn:!1,groupBy:!1,wrapClass:!0,mouseEnter:null,mouseLeave:null,shadow:!1,shadowX:0,shadowY:0,shadowRadius:6,shadowColor:"000000",shadowOpacity:0.8,shadowPosition:"outside",shadowFrom:!1}}})(jQuery);
